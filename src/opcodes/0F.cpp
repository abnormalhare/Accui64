// #include "../../inc/alu.hpp"
#include "../../inc/x64.hpp"
#include "../../inc/debug.hpp"
#include <iostream>

bool CPU::OP_0F_22() {
    u8 modrm_val = this->read();
    ModRM *modrm = new ModRM(
        getMask(modrm_val, 7, 6),
        getMask(modrm_val, 5, 3),
        getMask(modrm_val, 2, 0)
    );
    Reg *dst = &this->regs[modrm->_rm];
    u64 *cr = &this->cr_regs[modrm->_reg];

    RegType type = (this->isLongMode()) ? RegType::R64 : RegType::R32;
    
    *cr &= ~0xFFFFFFFF;
    *cr |= dst->e;

    std::cout << "MOV CR" << (int)modrm->_reg << ", " << getRegName(modrm->_rm, type) << std::endl;

    return false;
}

#define STUB_OP_0F(hex) \
bool CPU::OP_0F_##hex() { std::cout << "UNIMPLEMENTED OPCODE 0x0F 0x" #hex << std::endl; return this->HALT(); }

STUB_OP_0F(00)STUB_OP_0F(01)STUB_OP_0F(02)STUB_OP_0F(03)STUB_OP_0F(04)STUB_OP_0F(05)STUB_OP_0F(06)STUB_OP_0F(07)
STUB_OP_0F(08)STUB_OP_0F(09)STUB_OP_0F(0A)STUB_OP_0F(0B)STUB_OP_0F(0C)STUB_OP_0F(0D)STUB_OP_0F(0E)STUB_OP_0F(0F)
STUB_OP_0F(10)STUB_OP_0F(11)STUB_OP_0F(12)STUB_OP_0F(13)STUB_OP_0F(14)STUB_OP_0F(15)STUB_OP_0F(16)STUB_OP_0F(17)
STUB_OP_0F(18)STUB_OP_0F(19)STUB_OP_0F(1A)STUB_OP_0F(1B)STUB_OP_0F(1C)STUB_OP_0F(1D)STUB_OP_0F(1E)STUB_OP_0F(1F)
STUB_OP_0F(20)STUB_OP_0F(21)STUB_OP_0F(23)STUB_OP_0F(24)STUB_OP_0F(25)STUB_OP_0F(26)STUB_OP_0F(27)
STUB_OP_0F(28)STUB_OP_0F(29)STUB_OP_0F(2A)STUB_OP_0F(2B)STUB_OP_0F(2C)STUB_OP_0F(2D)STUB_OP_0F(2E)STUB_OP_0F(2F)
STUB_OP_0F(30)STUB_OP_0F(31)STUB_OP_0F(32)STUB_OP_0F(33)STUB_OP_0F(34)STUB_OP_0F(35)STUB_OP_0F(36)STUB_OP_0F(37)
STUB_OP_0F(38)STUB_OP_0F(39)STUB_OP_0F(3A)STUB_OP_0F(3B)STUB_OP_0F(3C)STUB_OP_0F(3D)STUB_OP_0F(3E)STUB_OP_0F(3F)
STUB_OP_0F(40)STUB_OP_0F(41)STUB_OP_0F(42)STUB_OP_0F(43)STUB_OP_0F(44)STUB_OP_0F(45)STUB_OP_0F(46)STUB_OP_0F(47)
STUB_OP_0F(48)STUB_OP_0F(49)STUB_OP_0F(4A)STUB_OP_0F(4B)STUB_OP_0F(4C)STUB_OP_0F(4D)STUB_OP_0F(4E)STUB_OP_0F(4F)
STUB_OP_0F(50)STUB_OP_0F(51)STUB_OP_0F(52)STUB_OP_0F(53)STUB_OP_0F(54)STUB_OP_0F(55)STUB_OP_0F(56)STUB_OP_0F(57)
STUB_OP_0F(58)STUB_OP_0F(59)STUB_OP_0F(5A)STUB_OP_0F(5B)STUB_OP_0F(5C)STUB_OP_0F(5D)STUB_OP_0F(5E)STUB_OP_0F(5F)
STUB_OP_0F(60)STUB_OP_0F(61)STUB_OP_0F(62)STUB_OP_0F(63)STUB_OP_0F(64)STUB_OP_0F(65)STUB_OP_0F(66)STUB_OP_0F(67)
STUB_OP_0F(68)STUB_OP_0F(69)STUB_OP_0F(6A)STUB_OP_0F(6B)STUB_OP_0F(6C)STUB_OP_0F(6D)STUB_OP_0F(6E)STUB_OP_0F(6F)
STUB_OP_0F(70)STUB_OP_0F(71)STUB_OP_0F(72)STUB_OP_0F(73)STUB_OP_0F(74)STUB_OP_0F(75)STUB_OP_0F(76)STUB_OP_0F(77)
STUB_OP_0F(78)STUB_OP_0F(79)STUB_OP_0F(7A)STUB_OP_0F(7B)STUB_OP_0F(7C)STUB_OP_0F(7D)STUB_OP_0F(7E)STUB_OP_0F(7F)
STUB_OP_0F(80)STUB_OP_0F(81)STUB_OP_0F(82)STUB_OP_0F(83)STUB_OP_0F(84)STUB_OP_0F(85)STUB_OP_0F(86)STUB_OP_0F(87)
STUB_OP_0F(88)STUB_OP_0F(89)STUB_OP_0F(8A)STUB_OP_0F(8B)STUB_OP_0F(8C)STUB_OP_0F(8D)STUB_OP_0F(8E)STUB_OP_0F(8F)
STUB_OP_0F(90)STUB_OP_0F(91)STUB_OP_0F(92)STUB_OP_0F(93)STUB_OP_0F(94)STUB_OP_0F(95)STUB_OP_0F(96)STUB_OP_0F(97)
STUB_OP_0F(98)STUB_OP_0F(99)STUB_OP_0F(9A)STUB_OP_0F(9B)STUB_OP_0F(9C)STUB_OP_0F(9D)STUB_OP_0F(9E)STUB_OP_0F(9F)
STUB_OP_0F(A0)STUB_OP_0F(A1)STUB_OP_0F(A2)STUB_OP_0F(A3)STUB_OP_0F(A4)STUB_OP_0F(A5)STUB_OP_0F(A6)STUB_OP_0F(A7)
STUB_OP_0F(A8)STUB_OP_0F(A9)STUB_OP_0F(AA)STUB_OP_0F(AB)STUB_OP_0F(AC)STUB_OP_0F(AD)STUB_OP_0F(AE)STUB_OP_0F(AF)
STUB_OP_0F(B0)STUB_OP_0F(B1)STUB_OP_0F(B2)STUB_OP_0F(B3)STUB_OP_0F(B4)STUB_OP_0F(B5)STUB_OP_0F(B6)STUB_OP_0F(B7)
STUB_OP_0F(B8)STUB_OP_0F(B9)STUB_OP_0F(BA)STUB_OP_0F(BB)STUB_OP_0F(BC)STUB_OP_0F(BD)STUB_OP_0F(BE)STUB_OP_0F(BF)
STUB_OP_0F(C0)STUB_OP_0F(C1)STUB_OP_0F(C2)STUB_OP_0F(C3)STUB_OP_0F(C4)STUB_OP_0F(C5)STUB_OP_0F(C6)STUB_OP_0F(C7)
STUB_OP_0F(C8)STUB_OP_0F(C9)STUB_OP_0F(CA)STUB_OP_0F(CB)STUB_OP_0F(CC)STUB_OP_0F(CD)STUB_OP_0F(CE)STUB_OP_0F(CF)
STUB_OP_0F(D0)STUB_OP_0F(D1)STUB_OP_0F(D2)STUB_OP_0F(D3)STUB_OP_0F(D4)STUB_OP_0F(D5)STUB_OP_0F(D6)STUB_OP_0F(D7)
STUB_OP_0F(D8)STUB_OP_0F(D9)STUB_OP_0F(DA)STUB_OP_0F(DB)STUB_OP_0F(DC)STUB_OP_0F(DD)STUB_OP_0F(DE)STUB_OP_0F(DF)
STUB_OP_0F(E0)STUB_OP_0F(E1)STUB_OP_0F(E2)STUB_OP_0F(E3)STUB_OP_0F(E4)STUB_OP_0F(E5)STUB_OP_0F(E6)STUB_OP_0F(E7)
STUB_OP_0F(E8)STUB_OP_0F(E9)STUB_OP_0F(EA)STUB_OP_0F(EB)STUB_OP_0F(EC)STUB_OP_0F(ED)STUB_OP_0F(EE)STUB_OP_0F(EF)
STUB_OP_0F(F0)STUB_OP_0F(F1)STUB_OP_0F(F2)STUB_OP_0F(F3)STUB_OP_0F(F4)STUB_OP_0F(F5)STUB_OP_0F(F6)STUB_OP_0F(F7)
STUB_OP_0F(F8)STUB_OP_0F(F9)STUB_OP_0F(FA)STUB_OP_0F(FB)STUB_OP_0F(FC)STUB_OP_0F(FD)STUB_OP_0F(FE)STUB_OP_0F(FF)

#undef STUB_OP_0F